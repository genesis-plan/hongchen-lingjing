<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ® å…ƒå¢ƒå¤§åŒ Â· èµ›åšå›½é£æŠ€èƒ½å…±åˆ›ç©ºé—´</title>
    <style>
        :root { --primary: #6a11cb; --secondary: #2575fc; --accent: #ff7e5f; --dark: #2d3436; --light: #f9f9f9; }
        * { box-sizing: border-box; margin: 0; font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif; }
        body { background: linear-gradient(135deg, #fdfcfb 0%, #e2d1c3 100%); color: #333; min-height: 100vh; padding: 20px; }
        .container { max-width: 900px; margin: 30px auto; background: rgba(255, 255, 255, 0.95); padding: 30px; border-radius: 24px; box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1); border: 1px solid rgba(255, 255, 255, 0.5); }
        h1, h2 { text-align: center; color: var(--dark); margin-bottom: 15px; }
        h1 { font-size: 2.8em; background: linear-gradient(to right, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .slogan { text-align: center; font-size: 1.1em; margin-bottom: 30px; color: #666; font-style: italic; }
        .nav-tabs { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-bottom: 30px; padding-bottom: 15px; border-bottom: 2px solid #eee; }
        .tab-btn { padding: 12px 25px; background: none; border: 2px solid transparent; border-radius: 50px; cursor: pointer; font-size: 1em; font-weight: 500; transition: all 0.3s; }
        .tab-btn.active, .tab-btn:hover { background: var(--primary); color: white; border-color: var(--primary); }
        .tab-content { display: none; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .tab-content.active { display: block; }
        .path-selector { display: flex; gap: 25px; justify-content: center; margin: 40px 0; flex-wrap: wrap; }
        .path-card { flex: 1; min-width: 280px; border: 2px solid #e0e0e0; padding: 30px; border-radius: 20px; text-align: center; cursor: pointer; transition: all 0.4s; background: white; }
        .path-card:hover { transform: translateY(-8px); box-shadow: 0 15px 30px rgba(106, 17, 203, 0.15); }
        .path-card.selected { border-color: var(--primary); background: linear-gradient(135deg, #f9f7ff 0%, #eef2ff 100%); }
        .path-icon { font-size: 3.5em; margin-bottom: 20px; }
        .wish-input, .skill-input { width: 100%; padding: 18px; border: 2px solid #ddd; border-radius: 12px; font-size: 1em; margin-bottom: 20px; resize: vertical; transition: border 0.3s; }
        .wish-input:focus, .skill-input:focus { outline: none; border-color: var(--primary); }
        .btn { background: linear-gradient(to right, var(--primary), var(--secondary)); color: white; padding: 14px 32px; border: none; border-radius: 10px; cursor: pointer; font-size: 1em; font-weight: bold; display: inline-block; margin: 10px 5px; transition: all 0.3s; box-shadow: 0 4px 14px rgba(106, 17, 203, 0.4); }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(106, 17, 203, 0.6); opacity: 0.95; }
        .seed-tags { margin: 25px 0; display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; }
        .seed-tag { background: #e8f4ff; padding: 10px 20px; border-radius: 50px; cursor: pointer; font-size: 0.9em; transition: all 0.2s; border: 1px solid #c2e0ff; }
        .seed-tag:hover { background: #c2e0ff; transform: scale(1.05); }
        .list-item { background: #f8fafc; border-left: 5px solid var(--primary); padding: 20px; margin-bottom: 20px; border-radius: 12px; box-shadow: 0 3px 10px rgba(0,0,0,0.05); }
        .hidden { display: none; }
        .character-builder { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; margin: 25px 0; }
        .char-option { border: 2px solid #ddd; padding: 15px; text-align: center; border-radius: 12px; cursor: pointer; background: white; transition: all 0.3s; }
        .char-option.selected { border-color: var(--accent); background-color: #fff5f0; font-weight: bold; }
        #characterPreview { text-align: center; padding: 25px; border: 2px dashed var(--primary); border-radius: 15px; margin: 25px 0; font-size: 1.3em; min-height: 80px; background: #fcfaff; }
        footer { text-align: center; margin-top: 50px; padding-top: 20px; border-top: 1px solid #eee; color: #888; font-size: 0.9em; }
        .status-badge { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 0.8em; margin-left: 10px; }
        .status-pending { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® å…ƒå¢ƒå¤§åŒ</h1>
        <p class="slogan">ã€Œ ä»¥å¤é£ä¸ºéª¨ï¼Œä»¥ç§‘æŠ€ä¸ºç¿¼ï¼Œäººäººçš†æ˜¯æŠ€èƒ½å…±åˆ›è€… ã€</p>

        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <div class="nav-tabs">
            <button class="tab-btn active" onclick="switchTab('home')">ğŸ  åˆ›ä¸–å…¥å£</button>
            <button class="tab-btn" onclick="switchTab('wish')">ğŸ“œ å¿ƒæ„¿äº‘å¢™</button>
            <button class="tab-btn" onclick="switchTab('task')">ğŸ“‹ ä»»åŠ¡æ˜Ÿé˜</button>
            <button class="tab-btn" onclick="switchTab('create')">ğŸ› ï¸ é€ åŒ–å·¥åŠ</button>
        </div>

        <!-- é¦–é¡µï¼šæ–°æ‰‹å¼•å¯¼ -->
        <div id="home" class="tab-content active">
            <h2>ğŸšª é€‰æ‹©ä½ çš„å…ƒå¢ƒåˆä»£èº«ä»½</h2>
            <p style="text-align: center; color: #666;">é€‰æ‹©ä»»æ„è·¯å¾„ï¼Œå³åˆ»è§£é”ã€ŒæŠ€èƒ½å…±åˆ›ã€ä¹‹æƒ</p>
            <div class="path-selector">
                <div class="path-card" onclick="selectPath('tai-chi')" id="pathTaiChi">
                    <div class="path-icon">â˜¯ï¸</div>
                    <h3>è·¯å¾„ç”²ï¼šæ„ŸçŸ¥å†…åœ¨å¹³è¡¡</h3>
                    <p>ã€äº”éŸµå¤ªæ Â· å¯»èº«å¿ƒå…ƒå¾‹ã€‘</p>
                    <p>é€šè¿‡å¤è€çš„è¿åŠ¨ï¼Œæ„ŸçŸ¥èº«å¿ƒå¹³è¡¡ï¼Œæ‰¾åˆ°åˆ›é€ çš„èŠ‚å¥ã€‚</p>
                </div>
                <div class="path-card" onclick="selectPath('character')" id="pathCharacter">
                    <div class="path-icon">ğŸ‘¤</div>
                    <h3>è·¯å¾„ä¹™ï¼šé“¸å°±ä¸“å±çµç›¸</h3>
                    <p>ã€å¤é£æ•°å­—çµç›¸ Â· é“¸å…ƒå¢ƒé“æ ‡ã€‘</p>
                    <p>é€‰æ‹©ä¸€ä¸ªä»£è¡¨ä½ çš„åˆä»£å½¢è±¡ï¼Œå¼€å¯å…ƒå¢ƒä¹‹æ—…ã€‚</p>
                </div>
            </div>

            <!-- å¤ªæä½“éªŒå¼•å¯¼ -->
            <div id="taiChiGuide" class="hidden">
                <h3>â˜¯ï¸ å¤ªæå…¥é—¨å¼•å¯¼</h3>
                <p>1. ç«™ç«‹ï¼ŒåŒè„šä¸è‚©åŒå®½ï¼Œè†ç›–å¾®æ›²ï¼Œå…¨èº«æ”¾æ¾...</p>
                <button class="btn" onclick="completeTaiChi()">âœ… æˆ‘å·²ä½“éªŒå®Œæˆï¼Œè¿›å…¥å…ƒå¢ƒ</button>
            </div>

            <!-- å¤é£å½¢è±¡åˆ›å»ºå™¨ -->
            <div id="characterCreator" class="hidden">
                <h3>ğŸ‘¤ å…ƒå¢ƒçµç›¸é“¸é€  Â· æ–‡å­—ç‰ˆ</h3>
                <p>è¯·é€šè¿‡ä»¥ä¸‹é€‰æ‹©ï¼Œç»„åˆå‡ºä½ çš„ä¸“å±èº«ä»½æ ‡è¯†ï¼š</p>
                <div class="character-builder">
                    <div class="char-option" onclick="selectCharPart('hanfu', 'é½èƒ¸è¥¦è£™')">æ±‰æœ Â· é½èƒ¸è¥¦è£™</div>
                    <div class="char-option" onclick="selectCharPart('hanfu', 'åœ†é¢†è¢')">æ±‰æœ Â· åœ†é¢†è¢</div>
                    <div class="char-option" onclick="selectCharPart('hanfu', 'é©¬é¢è£™')">æ±‰æœ Â· é©¬é¢è£™</div>
                    <div class="char-option" onclick="selectCharPart('accessory', 'æœºæ¢°å‘ç°ª')">é…é¥° Â· æœºæ¢°å‘ç°ª</div>
                    <div class="char-option" onclick="selectCharPart('accessory', 'æ•°æ®æµè‹')">é…é¥° Â· æ•°æ®æµè‹</div>
                    <div class="char-option" onclick="selectCharPart('pattern', 'äº‘çº¹æ•°æ®æµ')">çº¹é¥° Â· äº‘çº¹æ•°æ®æµ</div>
                    <div class="char-option" onclick="selectCharPart('pattern', 'å¤ªæç”µè·¯çº¹')">çº¹é¥° Â· å¤ªæç”µè·¯çº¹</div>
                    <div class="char-option" onclick="selectCharPart('pattern', 'ä¹¾å¤äºŒè¿›åˆ¶')">çº¹é¥° Â· ä¹¾å¤äºŒè¿›åˆ¶</div>
                </div>
                <div id="characterPreview">çµç›¸æœªæ˜¾ï¼Œå¾…å›é€ åŒ–...</div>
                <button class="btn" onclick="generateCharacter()">ğŸ¨ ç”Ÿæˆå¹¶é“­åˆ»æˆ‘çš„çµç›¸</button>
                <p style="text-align:center; margin-top:20px;"><a href="javascript:skipCharacter()" style="color: #666;">[æš‚ä¸é“¸é€ ï¼Œç›´æ¥å…¥å¢ƒ]</a></p>
            </div>
        </div>

        <!-- å¿ƒæ„¿å¢™ -->
        <div id="wish" class="tab-content">
            <h2>ğŸ“œ å…ƒå¢ƒå¿ƒæ„¿äº‘å¢™</h2>
            <p style="text-align: center;">åœ¨æ­¤è®¸ä¸‹å¿ƒæ„¿ï¼šå›½é£å¦†é€  / ä¼ ç»ŸæŠ€è‰º / äºŒæ¬¡å…ƒåˆ›ä½œ / æ•°å­—è‰ºæœ¯...</p>
            <div class="seed-tags">
                <span class="seed-tag" onclick="fillWish('æƒ³å­¦3åˆ†é’Ÿæ±‰æœé½èƒ¸è¥¦è£™ç³»å¸¦çš„æ­£ç¡®æ–¹æ³•ï¼ˆæ— å·¥å…·ï¼Œæ–‡å­—ç‰ˆï¼‰')">#æ±‰æœç³»å¸¦</span>
                <span class="seed-tag" onclick="fillWish('æƒ³è¦ç®€å•çš„ä¼ ç»Ÿæ‹±æ‰‹ç¤¼/ä½œæ–ç¤¼æ•™å­¦ï¼ˆåˆ†åœºåˆï¼šæ—¥å¸¸/æ­£å¼ï¼‰')">#ä¼ ç»Ÿç¤¼ä»ª</span>
                <span class="seed-tag" onclick="fillWish('æƒ³è¦æ‰‹æœºç«¯10åˆ†é’Ÿå¤é£å¤´åƒæ¶‚é¸¦æ•™ç¨‹ï¼ˆæ–‡å­—ç‰ˆæ­¥éª¤ï¼‰')">#å¤é£æ¶‚é¸¦</span>
                <span class="seed-tag" onclick="fillWish('æƒ³å­¦ç®€å•çš„æ±‰å­—åŠ¨æ€æ•ˆæœåˆ¶ä½œæ–¹æ³•ï¼ˆæ–‡å­—ç‰ˆï¼Œä¸ç”¨è½¯ä»¶ï¼‰')">#æ±‰å­—åŠ¨ç”»</span>
                <span class="seed-tag" onclick="fillWish('æƒ³è¦å¤é£ç…§ç‰‡è°ƒè‰²å‚æ•°åˆ†äº«ï¼ˆæ‰‹æœºä¿®å›¾ï¼Œåˆ†åˆ†é’Ÿä¸Šæ‰‹ï¼‰')">#å¤é£è°ƒè‰²</span>
            </div>
            <textarea id="newWish" class="wish-input" placeholder="åœ¨æ­¤æè¿°ä½ æƒ³å­¦ä¼šçš„ç”Ÿæ´»æŠ€èƒ½æˆ–æ¸´æœ›çš„çŸ¥è¯†...ï¼ˆä¾‹å¦‚ï¼šå¦‚ä½•å¿«é€Ÿå å¥½ä¸€ä»¶æ±‰æœï¼‰"></textarea>
            <div style="text-align: center;">
                <button class="btn" onclick="submitWish()">âœ¨ å‘å¸ƒå¿ƒæ„¿è‡³äº‘ç«¯</button>
            </div>
            <div id="wishList">
                <div class="list-item">
                    <p><strong>ã€ç¤ºä¾‹å¿ƒæ„¿ã€‘</strong> æƒ³å­¦3åˆ†é’Ÿæ±‰æœé½èƒ¸è¥¦è£™ç³»å¸¦çš„æ­£ç¡®æ–¹æ³•ï¼ˆæ— å·¥å…·ï¼Œæ–‡å­—ç‰ˆï¼‰</p>
                    <p style="color: #888; margin-top: 8px;">å‘å¸ƒè€…ï¼šç³»ç»Ÿ | çŠ¶æ€ï¼š<span class="status-badge status-pending">å¾…å®ç°</span></p>
                </div>
            </div>
        </div>

        <!-- ä»»åŠ¡å¤§å… -->
        <div id="task" class="tab-content">
            <h2>ğŸ“‹ ä»»åŠ¡æ˜Ÿé˜ Â· å›½é£æŠ€èƒ½å¾…å…±åˆ›</h2>
            <p style="text-align: center;">ä»¥ä¸‹æ˜¯ç”±å¿ƒæ„¿è½¬åŒ–çš„ä»»åŠ¡ï¼Œç­‰å¾…æœ‰ç¼˜è¡Œè€…å°†å…¶è½¬åŒ–ä¸ºå¯ä¼ æ‰¿çš„æŠ€èƒ½ã€‚</p>
            <div id="taskList">
                <div class="list-item">
                    <h4>ä»»åŠ¡ï¼šæ±‰æœé½èƒ¸è¥¦è£™ç³»å¸¦æ•™ç¨‹</h4>
                    <p>æ¥æºå¿ƒæ„¿ï¼šâ€œæƒ³å­¦3åˆ†é’Ÿæ±‰æœé½èƒ¸è¥¦è£™ç³»å¸¦çš„æ­£ç¡®æ–¹æ³•â€</p>
                    <button class="btn" onclick="claimTask(1, 'æ±‰æœé½èƒ¸è¥¦è£™ç³»å¸¦æ•™ç¨‹')">ğŸ”— è®¤é¢†æ­¤ä»»åŠ¡</button>
                </div>
                <div class="list-item">
                    <h4>ä»»åŠ¡ï¼šå¤é£å¤´åƒæ¶‚é¸¦å…¥é—¨</h4>
                    <p>æ¥æºå¿ƒæ„¿ï¼šâ€œæƒ³è¦æ‰‹æœºç«¯10åˆ†é’Ÿå¤é£å¤´åƒæ¶‚é¸¦æ•™ç¨‹â€</p>
                    <button class="btn" onclick="claimTask(2, 'å¤é£å¤´åƒæ¶‚é¸¦å…¥é—¨')">ğŸ”— è®¤é¢†æ­¤ä»»åŠ¡</button>
                </div>
            </div>
        </div>

        <!-- æŠ€èƒ½åˆ›å»ºå™¨ -->
        <div id="create" class="tab-content">
            <h2>ğŸ› ï¸ é€ åŒ–å·¥åŠ</h2>
            <p>ä½ æ­£åœ¨å°†ä»»åŠ¡ <strong id="currentTaskTitle">ã€è¯·å…ˆåˆ°â€œä»»åŠ¡æ˜Ÿé˜â€è®¤é¢†ä¸€ä¸ªä»»åŠ¡ã€‘</strong> è½¬åŒ–ä¸ºå¯ä¼ æ‰¿çš„æŠ€èƒ½ã€‚</p>
            <input type="text" id="skillTitle" class="skill-input" placeholder="ä¸ºä½ çš„æŠ€èƒ½èµ·ä¸€ä¸ªæ¸…æ™°çš„åå­—ï¼ˆä¾‹å¦‚ï¼šä¸‰åˆ†é’Ÿæ±‰æœç³»å¸¦æ³•ï¼‰">
            <textarea id="skillSteps" class="skill-input" rows="6" placeholder="è¯·æŒ‰æ­¥éª¤è¯¦ç»†æè¿°ï¼ˆä¾‹å¦‚ï¼š1. å‡†å¤‡... 2. ç¬¬ä¸€æ­¥æ“ä½œ... 3. å…³é”®è¦ç‚¹...ï¼‰"></textarea>
            <textarea id="skillNotes" class="skill-input" rows="3" placeholder="æ³¨æ„äº‹é¡¹æˆ–å¸¸è§è¯¯åŒºï¼ˆé€‰å¡«ï¼‰"></textarea>
            <div style="text-align: center;">
                <button class="btn" onclick="submitSkill()">ğŸš€ æäº¤æŠ€èƒ½è‡³åŸºçŸ³åº“</button>
                <button class="btn" style="background: linear-gradient(to right, #FF8A00, #FF2070);" onclick="aiAssist()">ğŸ¤– AIåŠ©æ‰‹ï¼šå¸®æˆ‘ä¼˜åŒ–æ ¼å¼</button>
            </div>
            <div id="creationResult" style="margin-top: 25px; text-align: center;"></div>
        </div>

        <footer>
            <p>å…ƒå¢ƒå¤§åŒ Â· åˆ›ä¸–å®éªŒ | çµç›¸ä¸å¿ƒæ„¿å­˜äºäº‘ç«¯ï¼Œä¼šè¯ç»ˆäº†æ—¶æœ¬åœ°ç—•è¿¹å°†åŒ¿ååŒ–ã€‚</p>
            <p style="font-size: 0.8em; color: #aaa;">å½“å‰æ ¸å¿ƒAPIå·²å°±ç»ªï¼šå¿ƒæ„¿å‘å¸ƒåŠŸèƒ½å¯çœŸå®è°ƒç”¨äº‘ç«¯å‡½æ•°ã€‚</p>
        </footer>
    </div>

    <script>
        /* ========== ã€æ ¸å¿ƒé…ç½®åŒºã€‘è¯·ç¡®ä¿å‡½æ•°é…ç½®æ­£ç¡® ==========
         * åœ¨é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—æ§åˆ¶å°ï¼Œæ£€æŸ¥ `meta-post-wish` å‡½æ•°ï¼š
         * 1. ã€é…ç½®ã€‘é¡µç­¾ä¸­ï¼Œç¯å¢ƒå˜é‡ `OSS_BUCKET_NAME` å·²è®¾ç½®ä¸º `datongyuzhou-static`
         * 2. ã€OSSæ§åˆ¶å°ã€‘ä¸­ï¼Œ`datongyuzhou-static` Bucket çš„ `data/` ç›®å½•ä¸‹å·²åˆ›å»ºç©ºæ–‡ä»¶ `wishes.json` (å†…å®¹ä¸º [])
         */
        const API_URL_POST_WISH = 'https://meta-post-wish-xoinuppars.cn-hongkong.fcapp.run';
        // =========================================================

        let userPath = null;
        let userCharacter = { hanfu: '', accessory: '', pattern: '' };
        let claimedTask = { id: null, title: 'ã€è¯·å…ˆåˆ°â€œä»»åŠ¡æ˜Ÿé˜â€è®¤é¢†ä¸€ä¸ªä»»åŠ¡ã€‘' };

        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            event.currentTarget.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            if (tabName === 'wish') loadWishes();
        }

        function selectPath(path) {
            userPath = path;
            document.getElementById('pathTaiChi').classList.remove('selected');
            document.getElementById('pathCharacter').classList.remove('selected');
            document.getElementById('taiChiGuide').classList.add('hidden');
            document.getElementById('characterCreator').classList.add('hidden');

            event.currentTarget.closest('.path-card').classList.add('selected');
            document.getElementById(path + 'Guide').classList.remove('hidden');
        }

        function completeTaiChi() {
            alert('å¤ªæä½“éªŒå®Œæˆï¼ä½ å·²è·å¾—ã€Œèº«å¿ƒå¹³è¡¡ã€çŠ¶æ€ã€‚æ­£åœ¨è¿›å…¥å…ƒå¢ƒ...');
            localStorage.setItem('userPath', 'tai-chi');
            switchTab('wish');
        }

        function selectCharPart(category, value) {
            const el = event.currentTarget;
            const wasSelected = el.classList.contains('selected');
            document.querySelectorAll('.char-option').forEach(opt => {
                if (opt.getAttribute('data-cat') === category) opt.classList.remove('selected');
            });
            if (!wasSelected) {
                el.classList.add('selected');
                el.setAttribute('data-cat', category);
                userCharacter[category] = value;
            } else {
                userCharacter[category] = '';
            }
            updateCharacterPreview();
        }

        function updateCharacterPreview() {
            const parts = [];
            if (userCharacter.hanfu) parts.push(userCharacter.hanfu);
            if (userCharacter.accessory) parts.push(`é…${userCharacter.accessory}`);
            if (userCharacter.pattern) parts.push(`é¥°${userCharacter.pattern}`);
            const preview = parts.length > 0 ? parts.join(' Â· ') : 'çµç›¸æœªæ˜¾ï¼Œå¾…å›é€ åŒ–...';
            document.getElementById('characterPreview').innerText = preview;
        }

        function generateCharacter() {
            if (!userCharacter.hanfu) { alert('è¯·è‡³å°‘é€‰æ‹©ä¸€é¡¹æ±‰æœå½¢åˆ¶ï¼Œæ­¤ä¸ºçµç›¸ä¹‹åŸºã€‚'); return; }
            localStorage.setItem('userCharacter', JSON.stringify(userCharacter));
            localStorage.setItem('userPath', 'character');
            alert(`çµç›¸ã€${document.getElementById('characterPreview').innerText}ã€‘å·²é“­åˆ»ï¼æ­¤ä¹ƒä½ åœ¨å…ƒå¢ƒä¹‹é“æ ‡ã€‚`);
            switchTab('wish');
        }

        function skipCharacter() {
            if (confirm('ç›´æ¥å…¥å¢ƒå°†ä½¿ç”¨é»˜è®¤äº‘æ¸¸è¡Œè€…èº«ä»½ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ')) {
                localStorage.setItem('userPath', 'skipped');
                switchTab('wish');
            }
        }

        // å¿ƒæ„¿å¢™åŠŸèƒ½
        function fillWish(text) {
            document.getElementById('newWish').value = text;
        }

        async function submitWish() {
            const content = document.getElementById('newWish').value.trim();
            if (!content) { alert('å¿ƒæ„¿å†…å®¹ä¸å¯ä¸ºç©ºã€‚'); return; }

            const submitBtn = event.currentTarget;
            submitBtn.disabled = true;
            submitBtn.textContent = 'å‘å¸ƒä¸­...';

            try {
                const response = await fetch(API_URL_POST_WISH, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        content: content,
                        author: localStorage.getItem('userCharacter') ? 'çµç›¸è¡Œè€…' : 'äº‘æ¸¸è¡Œè€…'
                    })
                });

                const result = await response.json();
                if (response.ok && result.success) {
                    alert('âœ¨ å¿ƒæ„¿å·²æˆåŠŸå‘å¸ƒè‡³ã€Œå…ƒå¢ƒã€ï¼å®ƒå·²è½¬åŒ–ä¸ºä»»åŠ¡ï¼Œç­‰å¾…å…¶ä»–è¡Œè€…å®ç°ã€‚');
                    document.getElementById('newWish').value = '';
                    // æ­¤å¤„æœªæ¥å¯è°ƒç”¨ getWishes åˆ·æ–°åˆ—è¡¨
                } else {
                    alert(`å‘å¸ƒå¤±è´¥ï¼š${result.message || 'æœªçŸ¥é”™è¯¯'}`);
                }
            } catch (error) {
                console.error('å‘å¸ƒå¿ƒæ„¿å‡ºé”™:', error);
                alert('ç½‘ç»œæ³¢åŠ¨ï¼Œè¿æ¥å…ƒå¢ƒå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'âœ¨ å‘å¸ƒå¿ƒæ„¿è‡³äº‘ç«¯';
            }
        }

        function loadWishes() {
            // æ­¤å¤„é¢„ç•™ï¼šæœªæ¥æ¥å…¥ `meta-get-wishes` å‡½æ•°åï¼Œå¯åŠ¨æ€åŠ è½½åˆ—è¡¨
            document.getElementById('wishList').innerHTML = `
                <div class="list-item">
                    <p><strong>ã€ç¤ºä¾‹å¿ƒæ„¿ã€‘</strong> æƒ³å­¦3åˆ†é’Ÿæ±‰æœé½èƒ¸è¥¦è£™ç³»å¸¦çš„æ­£ç¡®æ–¹æ³•ï¼ˆæ— å·¥å…·ï¼Œæ–‡å­—ç‰ˆï¼‰</p>
                    <p style="color: #888; margin-top: 8px;">å‘å¸ƒè€…ï¼šç³»ç»Ÿ | çŠ¶æ€ï¼š<span class="status-badge status-pending">å¾…å®ç°</span></p>
                </div>
                <div class="list-item">
                    <p><strong>ã€ç”¨æˆ·å¿ƒæ„¿ã€‘</strong> <span id="latestWish">ç­‰å¾…ä½ çš„ç¬¬ä¸€ä¸ªçœŸå®å¿ƒæ„¿...</span></p>
                    <p style="color: #888; margin-top: 8px;">å‘å¸ƒè€…ï¼šä½  | çŠ¶æ€ï¼š<span class="status-badge status-pending">å·²å‘å¸ƒ</span></p>
                </div>
            `;
        }

        function claimTask(id, title) {
            claimedTask = { id, title };
            document.getElementById('currentTaskTitle').innerText = `ã€${title}ã€‘`;
            alert(`âœ… å·²æˆåŠŸè®¤é¢†ä»»åŠ¡ã€Œ${title}ã€ï¼è¯·å‰å¾€ã€Œé€ åŒ–å·¥åŠã€å°†å…¶è½¬åŒ–ä¸ºæŠ€èƒ½ã€‚`);
            switchTab('create');
        }

        function submitSkill() {
            const title = document.getElementById('skillTitle').value.trim();
            const steps = document.getElementById('skillSteps').value.trim();
            if (!title || !steps) { alert('è¯·å¡«å†™æŠ€èƒ½æ ‡é¢˜å’Œå…·ä½“æ­¥éª¤ã€‚'); return; }
            if (claimedTask.id === null) { alert('è¯·å…ˆè®¤é¢†ä¸€ä¸ªä»»åŠ¡ã€‚'); return; }

            document.getElementById('creationResult').innerHTML = `
                <div class="list-item" style="background: #e8f7f0; border-left-color: #2ecc71;">
                    <h4>âœ… æŠ€èƒ½æäº¤æˆåŠŸï¼</h4>
                    <p>æŠ€èƒ½ã€Š${title}ã€‹å·²æäº¤è‡³åŸºçŸ³åº“ï¼Œç­‰å¾…å®¡æ ¸ã€‚æ„Ÿè°¢ä½ çš„æ™ºæ…§è´¡çŒ®ï¼</p>
                    <p>è®¤é¢†çš„ä»»åŠ¡ã€${claimedTask.title}ã€‘çŠ¶æ€å·²æ›´æ–°ã€‚</p>
                </div>
            `;
            // æ­¤å¤„é¢„ç•™ï¼šæœªæ¥æ¥å…¥ `meta-submit-skill` å‡½æ•°
            setTimeout(() => {
                document.getElementById('skillTitle').value = '';
                document.getElementById('skillSteps').value = '';
                document.getElementById('skillNotes').value = '';
                document.getElementById('creationResult').innerHTML = '';
            }, 5000);
        }

        function aiAssist() {
            const steps = document.getElementById('skillSteps').value;
            if (!steps) {
                alert('ğŸ¤– AIåŠ©æ‰‹ï¼šè¯·å…ˆè¾“å…¥ä¸€äº›æ­¥éª¤æè¿°ï¼Œæˆ‘æ¥å¸®ä½ ä¼˜åŒ–ç»“æ„ã€‚');
                return;
            }
            alert('ğŸ¤– AIåŠ©æ‰‹ï¼šå·²æ”¶åˆ°ä½ çš„æ–‡æœ¬ã€‚æ­¤åŠŸèƒ½å¾…æ¥å…¥å¤§æ¨¡å‹æœåŠ¡åï¼Œå¯è‡ªåŠ¨ä¼˜åŒ–æ ¼å¼ã€è¡¥å……è¦ç‚¹ã€‚');
        }

        // åˆå§‹åŒ–
        window.onload = function() {
            const savedPath = localStorage.getItem('userPath');
            if (savedPath && savedPath !== 'skipped') {
                switchTab('wish');
            }
            // åŠ è½½ç¤ºä¾‹æ•°æ®
            loadWishes();
        };
    </script>
</body>
</html>